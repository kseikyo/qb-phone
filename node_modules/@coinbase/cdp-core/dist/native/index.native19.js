import { createEndUserEvmSmartAccount as m } from "@coinbase/cdp-api-client";
import { Analytics as i } from "./index.native30.js";
import "./index.native31.js";
import { toAuthStateUser as u } from "./index.native35.js";
import { getCoreAuthManager as A, getConfig as f } from "./index.native28.js";
import { createEvmEoaAccount as p } from "./index.native18.js";
import { InternalError as S } from "./index.native24.js";
import { validateUserCanCreateAccount as h } from "./index.native44.js";
async function y(n) {
  i.sendActionCallEvent({ name: "create_evm_smart_account" });
  const t = A(), { user: e, authState: a } = h(
    t.getUser(),
    t.getAuthState(),
    "smart"
  ), c = await (async () => e.evmAccounts?.[0] ?? p())(), s = await m(
    f().projectId,
    e.userId,
    {
      owner: c,
      enableSpendPermissions: n?.enableSpendPermissions ?? !1
    }
  ), r = u(s);
  await t.setAuthState({
    ...a,
    user: r
  });
  const o = r.evmSmartAccounts?.[0];
  if (!o)
    throw new S(
      "EVM Smart Account was not created. Check the network log for more details."
    );
  return o;
}
export {
  y as createEvmSmartAccount
};
