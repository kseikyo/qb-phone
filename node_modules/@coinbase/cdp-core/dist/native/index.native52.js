import { DisconnectedError as l, from as d } from "./index.native61.js";
import { validateRequest as h, EIP1193ProviderError as m, STANDARD_ERROR_CODES as _ } from "./index.native26.js";
import { createEOAHandlers as p } from "./index.native62.js";
import { createSmartAccountHandlers as g } from "./index.native63.js";
import "viem";
import "zustand";
import "@coinbase/cdp-api-client";
function v(c, a, r) {
  a.subscribe(
    (e) => e.chainId,
    (e, t) => {
      e !== t && c.emit("chainChanged", e);
    }
  ), a.subscribe(
    (e) => e.user,
    (e, t) => {
      if (!(e?.userId === t?.userId && e?.evmAccounts?.length === t?.evmAccounts?.length)) {
        if (!e && t) {
          c.emit("disconnect", new l());
          return;
        }
        if (e && e.evmAccounts?.length && (!t || t.evmAccounts?.length === 0)) {
          const s = a.getState().chainId;
          c.emit("connect", { chainId: s });
          return;
        }
      }
    }
  );
  const { chainId: i, setChainId: o } = a.getState(), u = i || r.chains[0].id;
  return i || o(u), d({
    request: async (e) => {
      h(e, r);
      const t = e, s = a.getState().user, n = !!(s?.evmSmartAccounts && s.evmSmartAccounts.length > 0) ? g() : p();
      switch (t.method) {
        case "eth_accounts":
          return n.eth_accounts();
        case "eth_requestAccounts":
          return n.eth_requestAccounts(c, a);
        case "personal_sign":
          return n.personal_sign(t.params, a);
        case "eth_sendTransaction":
          return n.eth_sendTransaction(t.params, a, r.transports);
        case "wallet_disconnect":
          return n.wallet_disconnect();
        case "wallet_switchEthereumChain":
          return n.wallet_switchEthereumChain(t.params, a);
        case "eth_sign":
          return n.eth_sign(t.params, a);
        case "eth_signTypedData_v4":
          return n.eth_signTypedData_v4(t.params, a);
        case "eth_chainId":
          return n.eth_chainId(a);
        case "wallet_sendCalls":
          return n.wallet_sendCalls(t.params, a);
        case "wallet_getCallsStatus":
          return n.wallet_getCallsStatus(t.params, a);
        case "wallet_getCapabilities":
          return n.wallet_getCapabilities();
        // Catch-all for any unknown method
        default:
          throw new m(
            _.provider.unsupportedMethod,
            `Method ${t.method} not supported`
          );
      }
    },
    // Event emitter methods - only the ones required by the interface
    on: c.on.bind(c),
    removeListener: c.removeListener.bind(c)
  });
}
export {
  v as createProvider
};
