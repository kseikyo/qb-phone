import { hashMessage as e, hexToString as s, bytesToString as c } from "viem";
import { signAndWrapTypedDataForSmartAccount as d } from "./index.native47.js";
import { validateUserOwnsSmartAccount as u, EIP1193ProviderError as g, STANDARD_ERROR_CODES as h } from "./index.native26.js";
async function m(r, o) {
  const [a, n] = r, i = await u(n);
  try {
    const { signature: t } = await d({
      smartAccount: n,
      ownerAddress: i.evmAccounts[0],
      hash: f(a),
      chainId: o.getState().chainId
    });
    return t;
  } catch (t) {
    throw new g(
      h.provider.userRejectedRequest,
      t instanceof Error ? t.message : "Signing failed"
    );
  }
}
function f(r) {
  return typeof r == "string" ? e(s(r)) : typeof r.raw == "string" ? r.raw : e(c(r.raw));
}
export {
  m as handlePersonalSign
};
